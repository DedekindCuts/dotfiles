#!/bin/bash

# prompt for install profile
echo "Which kind of setup would you like to do?"
select profile in $(ls $HOME/.yadm/profiles);
do
	# get settings from profile
	. "$HOME/.yadm/profiles/$profile"
	break;
done

# check if Xcode command line tools are installed and install if not
if type xcode-select >&- && xpath=$( xcode-select --print-path ) && test -d "${xpath}" && test -x "${xpath}"; then
	echo "$(tput setaf 2)Xcode command line tools installed and up to date.$(tput setaf 7)"
else
	echo "Installing Xcode command line tools..."
	xcode-select --install
	echo "$(tput setaf 2)Installed.$(tput setaf 7)"
fi

# install/update Homebrew and programs from Brewfile if desired
if [[ "$USE_HOMEBREW" == "true" ]]; then
	. "$HOME/.dotfiles/.brew/brew-install.sh"
fi

# install Conda if desired
if [[ "$USE_CONDA" == "true" ]]; then
	. "$HOME/.dotfiles/.conda/conda-install.sh"
fi

# install VS Code if not already and apply custom settings
. "$HOME/.dotfiles/.vscode-settings/vscode-setup.sh"

# prompt to install any programs that must be manually installed
. "$HOME/.dotfiles/.installs/show-manual-installs.sh"

# Replace Dock with applications and directories in dock-list.txt (if it exists)
. "$HOME/.dotfiles/.macos-settings/dock-set.sh"

# source .macos file to apply system-wide settings and preferences
echo "Would you like to apply custom macOS settings? (Requires password and restart)"
select answer in "Yes" "No"
do
	case $answer in
		Yes )
			. "$HOME/.dotfiles/.macos-settings/.macos"
			break;;
		No )
			break;;
	esac
done
